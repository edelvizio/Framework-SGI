<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Framework SGI (INPI) – Protótipo</title>
  <meta name="description" content="Protótipo do *framework* de Sistema de Gestão da Inovação (SGI) aplicado ao INPI, baseado na ISO 56000, TRIZ, TdM e Fuzzy/AHP." />
  <style>
    :root{
      --bg:#0b1020;--panel:#101935;--muted:#8792a2;--text:#eef2ff;--accent:#7aa2ff;--accent-2:#64d2ff;--ok:#48c774;--warn:#f2b705;--err:#ff5c7c;--chip:#1c254a
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:linear-gradient(180deg,#0b1020,#0b1020 40%,#0e1430);color:var(--text)}
    header{position:sticky;top:0;background:rgba(11,16,32,.7);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid #1d274d;z-index:10}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    h1{margin:0;font-size:clamp(20px,3.6vw,30px)}
    h2{font-size:clamp(18px,3vw,24px);margin:20px 0 8px}
    p,li{color:#c9d4ff}
    .grid{display:grid;gap:12px}
    @media(min-width:900px){.grid.cols-2{grid-template-columns:1fr 1fr}}
    @media(min-width:900px){.grid.cols-3{grid-template-columns:repeat(3,1fr)}}
    .card{background:var(--panel);border:1px solid #1d274d;border-radius:16px;padding:16px;box-shadow:0 10px 24px rgba(0,0,0,.18)}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    button,.btn{appearance:none;border:1px solid #2b3870;background:#172149;color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer}
    button:hover{border-color:#3e56c4}
    .primary{background:linear-gradient(135deg,var(--accent),var(--accent-2));border:0;color:#0b1020;font-weight:700}
    .ok{background:linear-gradient(135deg,#48c774,#7fe3a0);border:0;color:#062315;font-weight:700}
    .warn{background:linear-gradient(135deg,#f2b705,#ffd46b);border:0;color:#2a1f00;font-weight:700}
    .danger{background:linear-gradient(135deg,#ff5c7c,#ff95a9);border:0;color:#32000b;font-weight:700}
    input,select,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2b3870;background:#0f1633;color:var(--text)}
    label{display:block;margin:10px 0 6px;color:#cfe2ff}
    small, .help{color:var(--muted)}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{background:var(--chip);color:#d6e1ff;border:1px solid #2b3870;border-radius:999px;padding:6px 10px;font-size:12px}
    nav.tabs{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
    nav.tabs button{padding:10px 12px;border-radius:999px}
    nav.tabs button[aria-current="true"]{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#081229;border:0}
    .kpis{display:grid;gap:8px}
    @media(min-width:700px){.kpis{grid-template-columns:repeat(2,1fr)}}
    table{width:100%;border-collapse:collapse;border:1px solid #27336a;border-radius:12px;overflow:hidden}
    th,td{padding:10px;border-bottom:1px solid #27336a}
    th{background:#121c3f;text-align:left}
    tr:hover td{background:#0f1838}
    footer{opacity:.8}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Framework SGI – Protótipo utilizável (INPI)</h1>
      <p class="help">Baseado em ISO 56002/ISO 56007/ISO 56008, TRIZ (MPI), Teoria da Mudança e (Fuzzy) AHP. Funciona em celular e computador, salva no navegador.</p>
    </div>
  </header>

  <main class="wrap grid cols-2">
    <section class="card">
      <h2>Como usar</h2>
      <ol>
        <li>Siga as <strong>Etapas 1–4</strong> nas abas abaixo e preencha os campos.</li>
        <li>Use <em>Salvar</em> para gravar no seu dispositivo (localStorage).</li>
        <li>Você pode <em>Exportar JSON</em> para compartilhar e <em>Importar</em> depois.</li>
        <li>Ao terminar, gere um <em>Relatório</em> (tabela) e use <em>Imprimir/PDF</em>.</li>
      </ol>
      <div class="toolbar" role="group" aria-label="Ações gerais">
        <button class="primary" id="btnSave">Salvar</button>
        <button id="btnLoad">Recarregar</button>
        <button class="ok" id="btnExport">Exportar JSON</button>
        <label class="btn" for="fileImport">Importar JSON</label>
        <input id="fileImport" class="sr-only" type="file" accept="application/json" />
        <button class="warn" id="btnPrint">Imprimir / PDF</button>
        <button class="danger" id="btnClear">Limpar tudo</button>
      </div>
      <p class="help">Dica: o salvamento local é específico por navegador/dispositivo.</p>
      <div class="chips">
        <span class="chip">ISO 56002 (28 itens)</span>
        <span class="chip">TRIZ – MPI</span>
        <span class="chip">Teoria da Mudança</span>
        <span class="chip">ISO 56007 (Ideação)</span>
        <span class="chip">ISO 56008 (Medição)</span>
        <span class="chip">AHP / Fuzzy AHP</span>
      </div>
    </section>

    <section class="card">
      <h2>Relatório rápido</h2>
      <p class="help">Gera uma visão consolidada das ações e KPIs cadastrados.</p>
      <div class="toolbar">
        <button id="btnBuild">Atualizar relatório</button>
      </div>
      <div id="report"></div>
    </section>

    <section class="card" style="grid-column: 1 / -1;">
      <nav class="tabs" id="tabs" aria-label="Etapas">
        <button data-tab="e1" aria-current="true">Etapa 1 – Diagnóstico (ISO 56002)</button>
        <button data-tab="e2">Etapa 2 – Ideação (TRIZ / ISO 56007)</button>
        <button data-tab="e3">Etapa 3 – Tratamento das Incertezas</button>
        <button data-tab="e4">Etapa 4 – KPIs e Validação (ISO 56008)</button>
      </nav>

      <!-- Etapa 1 -->
      <div id="e1" class="tab card">
        <h3>Etapa 1 – Diagnóstico & Priorização</h3>
        <div class="grid cols-3">
          <div>
            <label for="org">Unidade/Setor</label>
            <input id="org" placeholder="Ex.: DIPCT, SRPCT" />
          </div>
          <div>
            <label for="e1_ini">Início (Etapa 1)</label>
            <input id="e1_ini" type="date" />
          </div>
          <div>
            <label for="e1_fim">Fim (Etapa 1)</label>
            <input id="e1_fim" type="date" />
          </div>
        </div>
        <label for="itensISO">Itens críticos ISO 56002 (separe por vírgulas)</label>
        <input id="itensISO" placeholder="Ex.: 4.3 Planejamento, 7.1 Recursos, 10 Melhoria..." />
        <label for="justISO">Justificativa / evidências</label>
        <textarea id="justISO" rows="4" placeholder="Descreva brevemente as lacunas e impactos no serviço."></textarea>
        <label for="ahpNotas">Notas de priorização (AHP/Fuzzy) – formato livre</label>
        <textarea id="ahpNotas" rows="3" placeholder="Anote pesos, RC, ou links para planilhas."></textarea>
      </div>

      <!-- Etapa 2 -->
      <div id="e2" class="tab card" hidden>
        <h3>Etapa 2 – Ideação (TRIZ / ISO 56007)</h3>
        <div class="grid cols-2">
          <div>
            <label for="e2_ini">Início (Etapa 2)</label>
            <input id="e2_ini" type="date" />
          </div>
          <div>
            <label for="e2_fim">Fim (Etapa 2)</label>
            <input id="e2_fim" type="date" />
          </div>
        </div>
        <label for="defProblema">Formulação do problema</label>
        <textarea id="defProblema" rows="3" placeholder="Defina o problema a partir dos itens críticos."></textarea>
        <label for="recursos">Recursos disponíveis</label>
        <textarea id="recursos" rows="3" placeholder="Pessoas, dados, sistemas, tempo, orçamento, parcerias..."></textarea>
        <label for="heuristicas">Heurísticas / princípios (MPI/TRIZ)</label>
        <textarea id="heuristicas" rows="3" placeholder="Liste heurísticas/TRIZ selecionadas e por quê."></textarea>
        <label for="ideias">Ideias geradas</label>
        <textarea id="ideias" rows="4" placeholder="Registre ideias priorizadas para protótipos."></textarea>
      </div>

      <!-- Etapa 3 -->
      <div id="e3" class="tab card" hidden>
        <h3>Etapa 3 – Tratamento das Incertezas</h3>
        <div class="grid cols-2">
          <div>
            <label for="e3_ini">Início (Etapa 3)</label>
            <input id="e3_ini" type="date" />
          </div>
          <div>
            <label for="e3_fim">Fim (Etapa 3)</label>
            <input id="e3_fim" type="date" />
          </div>
        </div>
        <div class="grid cols-2">
          <div>
            <label for="acoes">Ações priorizadas</label>
            <textarea id="acoes" rows="4" placeholder="Ação 1; Ação 2; Ação 3..."></textarea>
          </div>
          <div>
            <label for="responsaveis">Responsáveis / envolvidos</label>
            <textarea id="responsaveis" rows="4" placeholder="Nomes, equipes, parceiros..."></textarea>
          </div>
        </div>
        <div class="grid cols-2">
          <div>
            <label for="riscos">Incertezas, riscos e mitigação</label>
            <textarea id="riscos" rows="3" placeholder="Principais incertezas, riscos e como tratá-los."></textarea>
          </div>
          <div>
            <label for="experimentos">Experimentos / aprendizados esperados</label>
            <textarea id="experimentos" rows="3" placeholder="Testes, pilotos, critérios de parada."></textarea>
          </div>
        </div>
      </div>

      <!-- Etapa 4 -->
      <div id="e4" class="tab card" hidden>
        <h3>Etapa 4 – KPIs, Metas e Validação (ISO 56008)</h3>
        <div class="grid cols-2">
          <div>
            <label for="e4_ini">Início (Etapa 4)</label>
            <input id="e4_ini" type="date" />
          </div>
          <div>
            <label for="e4_fim">Fim (Etapa 4)</label>
            <input id="e4_fim" type="date" />
          </div>
        </div>
        <p class="help">Defina KPIs, metas e critérios de validação (ISO 56008). Use o botão para adicionar linhas.</p>
        <div class="toolbar">
          <button id="addKPI">Adicionar KPI</button>
        </div>
        <div class="kpis" id="kpiList"></div>
      </div>
    </section>

    <section class="card" style="grid-column:1/-1">
      <h2>Sobre</h2>
      <p>Este protótipo visa disponibilizar, em formato simples e responsivo, o <em>framework</em> de SGI aplicado ao INPI, contemplando diagnóstico (ISO 56002), ideação (TRIZ/ISO 56007), tratamento das incertezas e validação por KPIs (ISO 56008). Os dados ficam no seu navegador e podem ser exportados/importados em JSON.</p>
    </section>
  </main>

  <footer class="wrap" style="margin:40px auto 60px;">
    <small>v0.2.1 – Protótipo estático (GitHub Pages). © 2025</small>
  </footer>

  <script>
    // --- Estado e persistência ---
    const STORAGE_KEY = 'sgi-prototipo-v021';
    const el = id => document.getElementById(id);

    const state = {
      e1: { org:'', ini:'', fim:'', itensISO:'', justISO:'', ahpNotas:'' },
      e2: { ini:'', fim:'', defProblema:'', recursos:'', heuristicas:'', ideias:'' },
      e3: { ini:'', fim:'', acoes:'', responsaveis:'', riscos:'', experimentos:'' },
      e4: { ini:'', fim:'', kpis: [] }
    };

    function load(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      try{
        const data = JSON.parse(raw);
        if(data.e1){ Object.assign(state.e1, data.e1); }
        if(data.e2){ Object.assign(state.e2, data.e2); }
        if(data.e3){ Object.assign(state.e3, data.e3); }
        if(data.e4){ state.e4.kpis = Array.isArray(data.e4.kpis) ? data.e4.kpis : []; Object.assign(state.e4, data.e4); }
        // preencher inputs
        el('org').value = state.e1.org || '';
        el('e1_ini').value = state.e1.ini || '';
        el('e1_fim').value = state.e1.fim || '';
        el('itensISO').value = state.e1.itensISO || '';
        el('justISO').value = state.e1.justISO || '';
        el('ahpNotas').value = state.e1.ahpNotas || '';

        el('e2_ini').value = state.e2.ini || '';
        el('e2_fim').value = state.e2.fim || '';
        el('defProblema').value = state.e2.defProblema || '';
        el('recursos').value = state.e2.recursos || '';
        el('heuristicas').value = state.e2.heuristicas || '';
        el('ideias').value = state.e2.ideias || '';

        el('e3_ini').value = state.e3.ini || '';
        el('e3_fim').value = state.e3.fim || '';
        el('acoes').value = state.e3.acoes || '';
        el('responsaveis').value = state.e3.responsaveis || '';
        el('riscos').value = state.e3.riscos || '';
        el('experimentos').value = state.e3.experimentos || '';

        el('e4_ini').value = state.e4.ini || '';
        el('e4_fim').value = state.e4.fim || '';
        renderKPIs();
      }catch(e){
        alert('Falha ao carregar dados salvos.');
      }
    }

    function save(){
      // coletar Etapa 1
      state.e1.org = el('org').value.trim();
      state.e1.ini = el('e1_ini').value;
      state.e1.fim = el('e1_fim').value;
      state.e1.itensISO = el('itensISO').value.trim();
      state.e1.justISO = el('justISO').value.trim();
      state.e1.ahpNotas = el('ahpNotas').value.trim();

      // Etapa 2
      state.e2.ini = el('e2_ini').value;
      state.e2.fim = el('e2_fim').value;
      state.e2.defProblema = el('defProblema').value.trim();
      state.e2.recursos = el('recursos').value.trim();
      state.e2.heuristicas = el('heuristicas').value.trim();
      state.e2.ideias = el('ideias').value.trim();

      // Etapa 3
      state.e3.ini = el('e3_ini').value;
      state.e3.fim = el('e3_fim').value;
      state.e3.acoes = el('acoes').value.trim();
      state.e3.responsaveis = el('responsaveis').value.trim();
      state.e3.riscos = el('riscos').value.trim();
      state.e3.experimentos = el('experimentos').value.trim();

      // Etapa 4
      state.e4.ini = el('e4_ini').value;
      state.e4.fim = el('e4_fim').value;

      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    // --- Abas ---
    document.getElementById('tabs').addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-tab]');
      if(!btn) return;
      const tabId = btn.getAttribute('data-tab');
      document.querySelectorAll('nav.tabs button').forEach(b=>b.setAttribute('aria-current','false'));
      btn.setAttribute('aria-current','true');
      document.querySelectorAll('.tab').forEach(p=>p.hidden = true);
      document.getElementById(tabId).hidden = false;
    });

    // --- KPIs ---
    function kpiTemplate(kpi, idx){
      return `
        <div class="card" data-idx="${idx}">
          <div class="grid cols-2">
            <div>
              <label>Nome do KPI</label>
              <input value="${kpi.nome||''}" data-field="nome" placeholder="Ex.: Tempo médio de exame PCT" />
            </div>
            <div>
              <label>Frequência</label>
              <select data-field="freq">
                ${['Mensal','Trimestral','Semestral','Anual'].map(f=>`<option ${kpi.freq===f?'selected':''}>${f}</option>`).join('')}
              </select>
            </div>
          </div>
          <div class="grid cols-2">
            <div>
              <label>Métrica (definição)</label>
              <input value="${kpi.metrica||''}" data-field="metrica" placeholder="Como é calculado?" />
            </div>
            <div>
              <label>Meta</label>
              <input value="${kpi.meta||''}" data-field="meta" placeholder="Ex.: ≤ 30 dias" />
            </div>
          </div>
          <div class="grid cols-2">
            <div>
              <label>Responsável</label>
              <input value="${kpi.owner||''}" data-field="owner" placeholder="Equipe/Servidor" />
            </div>
            <div>
              <label>Fonte de dados</label>
              <input value="${kpi.fonte||''}" data-field="fonte" placeholder="Sistema/planilha" />
            </div>
          </div>
          <div class="grid cols-2">
            <div>
              <label>Valor atual</label>
              <input value="${kpi.atual||''}" data-field="atual" placeholder="Ex.: 45 dias (jul/2025)" />
            </div>
            <div>
              <label>Critério de validação</label>
              <input value="${kpi.valid||''}" data-field="valid" placeholder="Ex.: 3 ciclos seguidos ≤ meta" />
            </div>
          </div>
          <div class="toolbar">
            <button class="danger" data-del>Remover</button>
          </div>
        </div>
      `;
    }

    function renderKPIs(){
      const list = el('kpiList');
      list.innerHTML = state.e4.kpis.map((k, i)=>kpiTemplate(k,i)).join('');
    }

    function addKPI(){
      state.e4.kpis.push({freq:'Mensal'});
      renderKPIs();
      save();
    }

    el('addKPI').addEventListener('click', addKPI);

    el('kpiList').addEventListener('input', (e)=>{
      const card = e.target.closest('[data-idx]');
      if(!card) return;
      const idx = Number(card.getAttribute('data-idx'));
      const field = e.target.getAttribute('data-field');
      if(!field) return;
      state.e4.kpis[idx][field] = e.target.value;
      save();
    });

    el('kpiList').addEventListener('click', (e)=>{
      if(e.target.matches('[data-del]')){
        const card = e.target.closest('[data-idx]');
        const idx = Number(card.getAttribute('data-idx'));
        state.e4.kpis.splice(idx,1);
        renderKPIs();
        save();
      }
    });

    // --- Relatório ---
    function buildReport(){
      save();
      // Coleta defensiva direto do DOM (garante valores mesmo sem salvar antes)
      const gv = (id)=>{ const n = document.getElementById(id); return n ? (n.value || '') : ''; };
      const e1i = state.e1.ini || gv('e1_ini');
      const e1f = state.e1.fim || gv('e1_fim');
      const e2i = state.e2.ini || gv('e2_ini');
      const e2f = state.e2.fim || gv('e2_fim');
      const e3i = state.e3.ini || gv('e3_ini');
      const e3f = state.e3.fim || gv('e3_fim');
      const e4i = state.e4.ini || gv('e4_ini');
      const e4f = state.e4.fim || gv('e4_fim');

      const rows = [];
      rows.push(['Unidade', state.e1.org || gv('org')]);
      // retrocompat: se existir dataRef (versão antiga), usa como período quando ini/fim vazios
      const legacyDataRef = gv('dataRef');
      const periodoE1 = (!e1i && !e1f && legacyDataRef) ? legacyDataRef : formatPeriod(e1i, e1f);
      rows.push(['Período (Etapa 1)', periodoE1]);
      rows.push(['Itens ISO 56002 críticos', state.e1.itensISO || gv('itensISO') || '—']);
      rows.push(['Justificativa', state.e1.justISO || gv('justISO') || '—']);
      rows.push(['Notas AHP/Fuzzy', state.e1.ahpNotas || gv('ahpNotas') || '—']);

      rows.push(['Período (Etapa 2)', formatPeriod(e2i, e2f)]);
      rows.push(['Problema (TRIZ)', state.e2.defProblema || gv('defProblema') || '—']);
      rows.push(['Recursos', state.e2.recursos || gv('recursos') || '—']);
      rows.push(['Heurísticas (MPI/TRIZ)', state.e2.heuristicas || gv('heuristicas') || '—']);
      rows.push(['Ideias priorizadas', state.e2.ideias || gv('ideias') || '—']);

      rows.push(['Período (Etapa 3)', formatPeriod(e3i, e3f)]);
      rows.push(['Ações', state.e3.acoes || gv('acoes') || '—']);
      rows.push(['Responsáveis', state.e3.responsaveis || gv('responsaveis') || '—']);
      rows.push(['Incertezas e riscos', state.e3.riscos || gv('riscos') || '—']);
      rows.push(['Experimentos/Aprendizados', state.e3.experimentos || gv('experimentos') || '—']);

      rows.push(['Período (Etapa 4)', formatPeriod(e4i, e4f)]);

      let html = '<table><thead><tr><th>Campo</th><th>Conteúdo</th></tr></thead><tbody>';
      html += rows.map(r=>`<tr><td>${escapeHtml(r[0])}</td><td>${escapeHtml(r[1])}</td></tr>`).join('');
      html += '</tbody></table>';

      if(state.e4.kpis.length){
        html += '<h3 style="margin-top:16px">KPIs</h3>';
        html += '<table><thead><tr><th>KPI</th><th>Métrica</th><th>Meta</th><th>Atual</th><th>Frequência</th><th>Responsável</th><th>Fonte</th><th>Validação</th></tr></thead><tbody>';
        html += state.e4.kpis.map(k=>`<tr>
            <td>${escapeHtml(k.nome||'')}</td>
            <td>${escapeHtml(k.metrica||'')}</td>
            <td>${escapeHtml(k.meta||'')}</td>
            <td>${escapeHtml(k.atual||'')}</td>
            <td>${escapeHtml(k.freq||'')}</td>
            <td>${escapeHtml(k.owner||'')}</td>
            <td>${escapeHtml(k.fonte||'')}</td>
            <td>${escapeHtml(k.valid||'')}</td>
        </tr>`).join('');
        html += '</tbody></table>';
      }

      el('report').innerHTML = html;
    }

    function formatPeriod(ini, fim){
      if(!ini && !fim) return '—';
      if(ini && fim) return `${ini} → ${fim}`;
      if(ini && !fim) return `${ini} → (em andamento)`;
      return `(início não informado) → ${fim}`;
    }

    function escapeHtml(str){
      const d = document.createElement('div');
      d.textContent = (str==null? '': String(str));
      return d.innerHTML;
    }

    // --- Export/Import/Print/Clear ---
    el('btnSave').addEventListener('click', ()=>{ save(); alert('Salvo localmente.'); });
    el('btnLoad').addEventListener('click', ()=>{ load(); alert('Dados recarregados.'); });
    el('btnBuild').addEventListener('click', buildReport);
    el('btnExport').addEventListener('click', ()=>{
      save();
      const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `sgi-${(state.e1.org||'unidade').toLowerCase().replace(/\s+/g,'-')}.json`;
      a.click();
      URL.revokeObjectURL(a.href);
    });
    el('fileImport').addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const data = JSON.parse(reader.result);
          localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
          load();
          alert('Importado com sucesso.');
        }catch(err){
          alert('Arquivo inválido.');
        }
      };
      reader.readAsText(file);
    });
    el('btnPrint').addEventListener('click', ()=>{
      buildReport();
      setTimeout(()=>window.print(), 100);
    });
    el('btnClear').addEventListener('click', ()=>{
      if(confirm('Tem certeza que deseja apagar todos os dados locais?')){
        localStorage.removeItem(STORAGE_KEY);
        location.reload();
      }
    });

    // Autosave para todos os campos (evita perder datas antes do relatório)
    document.addEventListener('input', (e)=>{
      if(['INPUT','TEXTAREA','SELECT'].includes(e.target.tagName)) save();
    });
    document.addEventListener('change', (e)=>{
      if(['INPUT','TEXTAREA','SELECT'].includes(e.target.tagName)) save();
    });

    // Inicialização
    load();
    buildReport();
  </script>
</body>
</html>
